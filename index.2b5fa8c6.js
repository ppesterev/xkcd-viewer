!function(){const e=[],t=()=>e.forEach((e=>e()));window.addEventListener("DOMContentLoaded",t),window.addEventListener("popstate",t);let r=null,n=Date.now(),l=null;const a=(e,t=!1)=>fetch(`https://eigencors.herokuapp.com/${e}`).then((e=>{if(!e.ok)throw new Error(e.status);return t?e.text():e.json()})),o=()=>!r||Date.now()-n>3e5?a("https://xkcd.com/info.0.json").then((e=>(r=e,n=Date.now(),e))):Promise.resolve(r),s=document.querySelector("[data-strip-placeholder]"),i=document.querySelector("[data-strip-placeholder-message]"),c=document.querySelector(".strip"),d=c.querySelector("[data-strip-view-toggle]"),p=c.querySelector("[data-strip-image]"),u=c.querySelector("[data-strip-transcript]"),h=c.querySelector("[data-strip-number]"),m=c.querySelector("[data-strip-title]"),g=c.querySelector("[data-strip-date]"),y=c.querySelector("[data-strip-alt-text]"),v=c.querySelector("[data-strip-source-link]"),S=c.querySelector("[data-strip-explain-link]"),L=(e,t)=>{if(e)return s.style.display=null,c.style.display="none","404"===e.message?(s.classList.remove("strip-placeholder--loading"),s.classList.add("strip-placeholder--404"),void(i.textContent="Not Found")):(s.classList.remove("strip-placeholder--loading"),s.classList.add("strip-placeholder--error"),void(i.textContent="Error loading strip data"));s.style.display="none",c.style.display=null;const r=new Image;if(r.src=t.img,p.innerHTML="",t.link){const e=document.createElement("a");e.href=t.link,e.target="blank",e.appendChild(r),p.appendChild(e)}else p.appendChild(r);var n;u.innerHTML=(n=t.transcript)?n.replace(/{{[^{]*?([aA]lt|[tT]itle)[\ -]?([tT]ext)*:[^}]*?}}/,"").trim().replaceAll(/(?<!\<)\<(?!\<)/g,"&lt;").replaceAll(/(?<!\>)\>(?!\>)/g,"&gt;").replaceAll(/\<\<([\w\W]*?)\>\>/g,"<code>$1</code>").replaceAll(/\[\[([\w\W]*?)\]\]/g,"<strong>$1</strong>").replaceAll(/\(\(([\w\W]*?)\)\)/g,"<em>$1</em>").replaceAll(/\{\{([\w\W]*?)\}\}/g,"<em><strong>$1</strong></em>").split("\n\n").map((e=>`<p>${e.replaceAll("\n","<br>")}</p>`)).join(""):"<em>No transcript available</em>",h.textContent=`#${t.num}:`,m.innerHTML=`${t.title}`;const{year:l,month:a,day:o}=t,d=new Date(l,a-1,o);g.textContent=`Posted on ${d.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}`,y.textContent=t.alt,v.href=`https://xkcd.com/${t.num}`,S.href=`https://www.explainxkcd.com/wiki/index.php/${t.num}`};d.addEventListener("click",(()=>{p.classList.toggle("visually-hidden"),u.classList.toggle("visually-hidden"),d.classList.toggle("toggle-btn--image"),d.classList.toggle("toggle-btn--transcript")}));const f=document.querySelector(".navigation"),w=f.querySelector("[data-navlink-first]"),q=f.querySelector("[data-navlink-prev]"),x=f.querySelector("[data-navlink-next]"),k=f.querySelector("[data-navlink-latest]"),C=document.querySelector(".search"),$=document.querySelector(".search__input"),b=document.querySelector(".search__results");let A=!1;const _=()=>{b.innerHTML="",C.classList.add("search--idle")};C.classList.add("search--idle"),$.addEventListener("input",(e=>{_();e.target.value&&!A&&(A=!0,(l?Promise.resolve(l.slice()):a("https://xkcd.com/archive/",!0).then((e=>{const t=(new DOMParser).parseFromString(e,"text/html"),r=Array.from(t.links).filter((e=>e.pathname.match(/^\/[0-9]+\/$/)&&"Invalid Date"!==new Date(e.title).toString())).map((e=>({number:e.pathname.slice(1,e.pathname.length-1),date:new Date(e.title),title:e.textContent})));return l=r,r}))).then((e=>{A=!1;let t=e.filter((e=>e.title.toLowerCase().includes($.value.toLowerCase()))).slice(0,20);console.log(t),t.forEach((e=>{const t=document.querySelector("#search_result_template").content.cloneNode(!0),r=t.querySelector(".search__link"),n=t.querySelector(".search__result-number"),l=t.querySelector(".search__result-text");r.href=`/#${e.number}`,n.textContent=`#${e.number}`,l.textContent=e.title,r.addEventListener("click",(()=>{_()})),b.appendChild(t)})),t.length&&C.classList.remove("search--idle")})))})),document.addEventListener("focusout",(e=>{C.contains(e.relatedTarget)||_()})),(t=>{const r=()=>{const e=location.hash.slice(1)||"";t(e)};e.push(r)})((e=>{s.style.display=null,c.style.display="none",s.classList.add("strip-placeholder--loading"),s.classList.remove("strip-placeholder--error"),s.classList.remove("strip-placeholder--404"),i.textContent="Loading...",(e=>o().then((({num:t})=>{const r=parseInt(e);return!isNaN(r)&&r>=1&&r<=t?e:"random"===e?Math.floor(Math.random()*t+1).toString():""})))(e).then((r=>{if(e!==r)return(e=>{history.replaceState(null,null,e?`#${encodeURIComponent(e)}`:"#"),t()})(r);var n;o().then((e=>{var t,n;latestNum=e.num,displayedNum=parseInt(r)||latestNum,t=displayedNum,n=latestNum,1===t?(q.removeAttribute("href"),w.removeAttribute("href")):(q.href="#"+(t-1),w.href="#1"),t===n?(x.removeAttribute("href"),k.removeAttribute("href")):(x.href=`#${t+1}`,k.href="#")})),(n=r,n?a(`https://xkcd.com/${n}/info.0.json`):o()).then((e=>{L(null,e)})).catch((e=>{L(e,null)}))}))}))}();