!function(){const e=[],t=()=>e.forEach((e=>e())),r=e=>(e=>{location.hash=`#${encodeURIComponent(e)}`})(e);window.addEventListener("DOMContentLoaded",t),window.addEventListener("hashchange",t);let a=null,l=Date.now();const n=e=>fetch(`https://eigencors.herokuapp.com/${e}`).then((e=>e.json())).catch((()=>{throw new Error("Failed to load comic data")})),o=()=>!a||Date.now()-l>3e5?n("https://xkcd.com/info.0.json").then((e=>(a=e,l=Date.now(),e))):Promise.resolve(a),s=document.querySelector("[data-strip-placeholder]"),i=document.querySelector("[data-strip-placeholder-message]"),c=document.querySelector(".strip"),d=c.querySelector("[data-strip-view-toggle]"),p=c.querySelector("[data-strip-image]"),u=c.querySelector("[data-strip-transcript]"),h=c.querySelector("[data-strip-number]"),m=c.querySelector("[data-strip-title]"),y=c.querySelector("[data-strip-date]"),g=c.querySelector("[data-strip-alt-text]"),v=c.querySelector("[data-strip-source-link]"),f=c.querySelector("[data-strip-explain-link]"),w=e=>{if(!e)return s.style.display=null,c.style.display="none",s.classList.remove("strip-placeholder--loading"),s.classList.add("strip-placeholder--error"),void(i.textContent="Failed to load strip data");s.style.display="none",c.style.display=null;const t=new Image;if(t.src=e.img,p.innerHTML="",e.link){const r=document.createElement("a");r.href=e.link,r.target="blank",r.appendChild(t),p.appendChild(r)}else p.appendChild(t);var r;u.innerHTML=(r=e.transcript)?r.replace(/{{[^{]*?([aA]lt|[tT]itle)[\ -]?([tT]ext)*:[^}]*?}}/,"").trim().replaceAll(/(?<!\<)\<(?!\<)/g,"&lt;").replaceAll(/(?<!\>)\>(?!\>)/g,"&gt;").replaceAll(/\<\<([\w\W]*?)\>\>/g,"<code>$1</code>").replaceAll(/\[\[([\w\W]*?)\]\]/g,"<strong>$1</strong>").replaceAll(/\(\(([\w\W]*?)\)\)/g,"<em>$1</em>").replaceAll(/\{\{([\w\W]*?)\}\}/g,"<em><strong>$1</strong></em>").split("\n\n").map((e=>`<p>${e.replaceAll("\n","<br>")}</p>`)).join(""):"<em>No transcript available</em>",h.textContent=`#${e.num}:`,m.innerHTML=`${e.title}`;const{year:a,month:l,day:n}=e,o=new Date(a,l-1,n);y.textContent=`Posted on ${o.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}`,g.textContent=e.alt,v.href=`https://xkcd.com/${e.num}`,f.href=`https://www.explainxkcd.com/wiki/index.php/${e.num}`};d.addEventListener("click",(()=>{p.classList.toggle("visually-hidden"),u.classList.toggle("visually-hidden"),d.classList.toggle("toggle-btn--image"),d.classList.toggle("toggle-btn--transcript")}));const S=document.querySelector(".navigation"),q=S.querySelector("[data-navlink-first]"),L=S.querySelector("[data-navlink-prev]"),k=S.querySelector("[data-navlink-next]"),x=S.querySelector("[data-navlink-latest]");(t=>{const r=()=>{const e=location.hash.slice(1)||"";t(e)};e.push(r)})((e=>{(e=>o().then((({num:t})=>{const r=parseInt(e);return!isNaN(r)&&r>=1&&r<=t?e:"random"===e?Math.floor(Math.random()*t+1).toString():""})))(e).then((t=>{if(e!==t)return r(t);var a;o().then((e=>{var r,a;latestNum=e.num,displayedNum=parseInt(t)||latestNum,r=displayedNum,a=latestNum,1===r?(L.removeAttribute("href"),q.removeAttribute("href")):(L.href="#"+(r-1),q.href="#1"),r===a?(k.removeAttribute("href"),x.removeAttribute("href")):(k.href=`#${r+1}`,x.href="#")})),s.style.display=null,c.style.display="none",s.style.display=null,c.style.display="none",s.classList.add("strip-placeholder--loading"),s.classList.remove("strip-placeholder--error"),i.textContent="Loading...",(a=t,a?n(`https://xkcd.com/${a}/info.0.json`):o()).then((e=>{w(e)})).catch((()=>{w(null)}))}))}))}();