!function(){const e=[],t=()=>e.forEach((e=>e()));window.addEventListener("DOMContentLoaded",t),window.addEventListener("popstate",t);let n=null,r=Date.now();const a=e=>fetch(`https://eigencors.herokuapp.com/${e}`).then((e=>e.json())).catch((()=>{throw new Error("Failed to load comic data")})),l=()=>!n||Date.now()-r>3e5?a("https://xkcd.com/info.0.json").then((e=>(n=e,r=Date.now(),e))):Promise.resolve(n),o=document.querySelector(".strip"),i=o.querySelector("[data-strip-view-toggle]"),c=o.querySelector("[data-strip-image]"),s=o.querySelector("[data-strip-transcript]"),d=o.querySelector("[data-strip-number]"),p=o.querySelector("[data-strip-title]"),u=o.querySelector("[data-strip-date]"),m=o.querySelector("[data-strip-alt-text]"),h=o.querySelector("[data-strip-source-link]");i.addEventListener("click",(()=>{c.classList.toggle("visually-hidden"),s.classList.toggle("visually-hidden"),i.classList.toggle("toggle-btn--image"),i.classList.toggle("toggle-btn--transcript")}));const g=document.querySelector(".navigation");g.querySelectorAll("a").forEach((e=>{e.addEventListener("click",(n=>{var r;n.preventDefault(),r=new URL(e.href).searchParams.get("n"),history.pushState(null,null,r?`?n=${encodeURIComponent(r)}`:"?"),t()}))}));const y=g.querySelector("[data-navlink-first]"),v=g.querySelector("[data-navlink-prev]"),f=g.querySelector("[data-navlink-next]"),S=g.querySelector("[data-navlink-latest]");(t=>{const n=()=>{const e=new URL(location).searchParams.get("n")||"";t(e)};e.push(n)})((e=>{(e=>l().then((({num:t})=>{const n=parseInt(e);return!isNaN(n)&&n>=1&&n<=t?e:"random"===e?Math.floor(Math.random()*t+1).toString():""})))(e).then((n=>{if(e!==n)return(e=>{history.replaceState(null,null,e?`?n=${encodeURIComponent(e)}`:"?"),t()})(n);var r;(r=n,r?a(`https://xkcd.com/${r}/info.0.json`):l()).then((e=>{(e=>{const t=new Image;if(t.src=e.img,c.innerHTML="",e.link){const n=document.createElement("a");n.href=e.link,n.target="blank",n.appendChild(t),c.appendChild(n)}else c.appendChild(t);var n;s.innerHTML=(n=e.transcript)?n.replace(/{{[^{]*?([aA]lt|[tT]itle)[\ -]?([tT]ext)*:[^}]*?}}/,"").trim().replaceAll(/(?<!\<)\<(?!\<)/g,"&lt;").replaceAll(/(?<!\>)\>(?!\>)/g,"&gt;").replaceAll(/\<\<([\w\W]*?)\>\>/g,"<code>$1</code>").replaceAll(/\[\[([\w\W]*?)\]\]/g,"<strong>$1</strong>").replaceAll(/\(\(([\w\W]*?)\)\)/g,"<em>$1</em>").replaceAll(/\{\{([\w\W]*?)\}\}/g,"<em><strong>$1</strong></em>").split("\n\n").map((e=>`<p>${e.replaceAll("\n","<br>")}</p>`)).join(""):"<em>No transcript available</em>",d.textContent=`#${e.num}:`,p.innerHTML=`${e.title}`;const{year:r,month:a,day:l}=e,o=new Date(r,a-1,l);u.textContent=`Posted on ${o.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}`,m.textContent=e.alt,h.href=`https://xkcd.com/${e.num}`})(e),l().then((t=>{var n,r;displayedNum=e.num,latestNum=t.num,n=displayedNum,r=latestNum,1===n?(v.removeAttribute("href"),y.removeAttribute("href")):(v.href="?n="+(n-1),y.href="?n=1"),n===r?(f.removeAttribute("href"),S.removeAttribute("href")):(f.href=`?n=${n+1}`,S.href="?")}))}))}))}))}();